<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intervals &mdash; Dagor Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/tooltipster.custom.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/tooltipster.bundle.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/tooltipster-sideTip-shadow.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/tooltipster-sideTip-punk.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/tooltipster-sideTip-noir.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/tooltipster-sideTip-light.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/tooltipster-sideTip-borderless.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/micromodal.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/sphinx_rtd_theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../../../_static/gaijin.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../_static/js/hoverxref.js"></script>
        <script src="../../../../_static/js/tooltipster.bundle.min.js"></script>
        <script src="../../../../_static/js/micromodal.min.js"></script>
        <script src="../../../../_static/js/versionwarning.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
        <script src="../../../../_static/design-tabs.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Macros" href="macros.html" />
    <link rel="prev" title="Includes" href="includes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Dagor Documentation
              <img src="../../../../_static/gaijin_round_blur.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../dagor-home/index.html">Dagor Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/index.html">Getting Started with Dagor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/index.html">Tutorials and Manuals</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">API References and Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../dagor-render/index.html">Dagor Engine Render</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../quirrel-modules/index.html">Quirrel Modules Docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dagor-engine-docs/index.html">Engine Libraries Docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dagor-ecs/index.html">Dagor ECS</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Dagor Shading Language (DSHL) docs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../basic-concepts.html">Basic Concepts</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="conditionals.html">Conditionals</a></li>
<li class="toctree-l4"><a class="reference internal" href="data-types.html">Data types and variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="error.html">Throwing compilation errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="hardware.html">Hardware defines</a></li>
<li class="toctree-l4"><a class="reference internal" href="includes.html">Includes</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Intervals</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#optional-intervals">Optional intervals</a></li>
<li class="toctree-l5"><a class="reference internal" href="#assumes">Assumes</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="macros.html">Macros</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../channels.html">Channels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shaders.html">Shaders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../materials.html">Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../directives.html">Common directives</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intrinsics.html">Intrinsics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../global-constants.html">Global constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pipeline-states.html">Pipeline state configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../keywords.html">Keywords</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../samples/index.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dagor-tools/index.html">Dagor Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../assets/index.html">Assets and Assets Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../danetgame-framework/index.html">DaNetGame Framework</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Dagor Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">API References and Documentation</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Dagor Shading Language (DSHL) docs</a></li>
          <li class="breadcrumb-item"><a href="../basic-concepts.html">Basic Concepts</a></li>
      <li class="breadcrumb-item active">Intervals</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/api-references/dagor-dshl/index/basic-concepts/intervals.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="intervals">
<span id="id1"></span><h1>Intervals<a class="headerlink" href="#intervals" title="Permalink to this heading"></a></h1>
<p>Intervals are a way to generate multiple variants of a single <code class="docutils literal notranslate"><span class="pre">shader</span></code>, based on whether the value of a special variable falls into specific range.
They can be created from an <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">float</span></code> shader variable using the <code class="docutils literal notranslate"><span class="pre">interval</span></code> keyword.
Consider this example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">var</span><span class="p">;</span>
<span class="n">interval</span><span class="w"> </span><span class="n">var</span><span class="o">:</span><span class="n">below_zero</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">positive_less_than_four</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">four</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">five_or_higher</span><span class="p">;</span>
<span class="c1">// same goes for floats</span>
</pre></div>
</div>
<p>This declaration will create 5 permutations of the shader (<code class="docutils literal notranslate"><span class="pre">below_zero</span></code>, <code class="docutils literal notranslate"><span class="pre">zero</span></code>, <code class="docutils literal notranslate"><span class="pre">positive_less_than_four</span></code>, <code class="docutils literal notranslate"><span class="pre">four</span></code> and <code class="docutils literal notranslate"><span class="pre">five_or_higher</span></code>),
and the <code class="docutils literal notranslate"><span class="pre">var</span></code> interval itself can be accessed in hlsl blocks with special preprocessor tag <code class="docutils literal notranslate"><span class="pre">##</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">var</span><span class="p">;</span>
<span class="n">interval</span><span class="w"> </span><span class="n">var</span><span class="o">:</span><span class="n">below_zero</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">positive_less_than_four</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">four</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">five_or_higher</span><span class="p">;</span>

<span class="n">shader</span><span class="w"> </span><span class="n">example_shader</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">hlsl</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cp">##if var == five_or_higher</span>
<span class="w">      </span><span class="p">...</span>
<span class="w">    </span><span class="cp">##endif</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is essential to understand that this construction doesn’t mean that <code class="docutils literal notranslate"><span class="pre">var</span></code> equals to <code class="docutils literal notranslate"><span class="pre">5</span></code>, but
it means <code class="docutils literal notranslate"><span class="pre">var</span></code> is within the declared interval <code class="docutils literal notranslate"><span class="pre">five_or_higher</span></code>, so this syntax applies to <code class="docutils literal notranslate"><span class="pre">float</span></code> numbers as well.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Notice that intervals can be created not only from global variables (as in example above), but also from <code class="docutils literal notranslate"><span class="pre">static</span></code> and <code class="docutils literal notranslate"><span class="pre">dynamic</span></code> variables (described in <a class="reference internal" href="data-types.html#local-variables"><span class="std std-ref">Local variables</span></a>).</p>
<p>Intervals on <code class="docutils literal notranslate"><span class="pre">static</span></code> variables are resolved (appropriate shader variant is selected) only once during material instantiation, so
shader variants dependant on <code class="docutils literal notranslate"><span class="pre">static</span></code> variables are not switched during runtime.</p>
<p>Intervals on <code class="docutils literal notranslate"><span class="pre">dynamic</span></code> and global variables, however, are resolved each time the shader is used for rendering (on <code class="docutils literal notranslate"><span class="pre">setStates()</span></code> call), because such variables can change during runtime.
This has worse CPU performance impact, compared to <code class="docutils literal notranslate"><span class="pre">static</span></code> intervals.</p>
</div>
<section id="optional-intervals">
<h2>Optional intervals<a class="headerlink" href="#optional-intervals" title="Permalink to this heading"></a></h2>
<p>If the interval is used in HLSL code blocks, you can make this interval <code class="docutils literal notranslate"><span class="pre">optional</span></code>.
All conditions in HLSL code which use <code class="docutils literal notranslate"><span class="pre">optional</span></code> intervals will be replaced with HLSL branches, thus reducing the number of shader variants.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Shaders with <code class="docutils literal notranslate"><span class="pre">optional</span></code> intervals can be used only for conditionals in HLSL blocks and need to be compiled with <code class="docutils literal notranslate"><span class="pre">-optionalAsBranches</span></code> flag
(otherwise <code class="docutils literal notranslate"><span class="pre">optional</span></code> intervals will act the same as regular intervals).
This feature should only be used for dev build.</p>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">test_optional</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">optional</span><span class="w"> </span><span class="n">interval</span><span class="w"> </span><span class="n">test_optional</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">three</span><span class="p">;</span>

<span class="n">shader</span><span class="w"> </span><span class="n">testMaterial</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="w">  </span><span class="n">hlsl</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">float3</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">float3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="cp">##if test_optional == one</span>
<span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">float3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="cp">##elif test_optional == two || test_optional == three</span>
<span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">float3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="cp">##if test_optional == two</span>
<span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="cp">##endif</span>

<span class="cp">##else</span>
<span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">float3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="cp">##endif</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="assumes">
<h2>Assumes<a class="headerlink" href="#assumes" title="Permalink to this heading"></a></h2>
<p>Shader variables can be assigned a fixed value when the shader is compiled by <em>assuming</em>. Such shader vars may not be changed at runtime, their values will be constant in the binary.
This allows to reduce number of shader variants or disable specific features for specific platforms.</p>
<p>You can <em>assume</em> intervals inside a config .blk file for the shader compiler.
To do this, create an <code class="docutils literal notranslate"><span class="pre">assume_vars</span></code> block inside a <code class="docutils literal notranslate"><span class="pre">Compile</span></code> block and then specify the assumes you want, following regular .blk syntax:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Compile</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="w">  </span><span class="n">assume_vars</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">common_assumes</span><span class="p">.</span><span class="n">blk</span>
<span class="w">    </span><span class="nl">supports_sh_6_1</span><span class="p">:</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="nl">static_shadows_custom_fxaa</span><span class="p">:</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="w">    </span><span class="nl">grass_use_quads</span><span class="p">:</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="w">    </span><span class="nl">bloom_tex</span><span class="p">:</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By assuming a texture, e.g. <code class="docutils literal notranslate"><span class="pre">bloom_tex:i</span> <span class="pre">=</span> <span class="pre">1</span></code>, you declare that this texture is never <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
</div>
<p><strong>Assume statement</strong></p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">assume</span> <span class="pre">interval_name</span> <span class="pre">=</span> <span class="pre">interval_value;</span></code> statement in DSHL shaders to force an interval to be fixed.
This can be useful to disable unnecessary shader variants when the same interval is shared among different shaders.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">include</span><span class="w"> </span><span class="s">&quot;deferred_shadow_common.dshl&quot;</span>

<span class="n">shader</span><span class="w"> </span><span class="n">deferred_shadow_classify_tiles</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">assume</span><span class="w"> </span><span class="n">use_ssss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">off</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="includes.html" class="btn btn-neutral float-left" title="Includes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="macros.html" class="btn btn-neutral float-right" title="Macros" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Gaijin Entertainment 2024.
      <span class="lastupdated">Last updated on Dec 31, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>